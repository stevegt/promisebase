# RFC-1005
## Daemon UNIX Socket Protocol

Status: draft

### Overview

### Option 1

either client or daemon can be buyer or seller

buyer ---> seller
msgpack{"req", 68b329da9893e34099c7d8ad5cb9c940, arg1, arg2, b5532352e0c44597f3782ed66ddeb7c9, 49a3fb6f414ce8eb8548e24466ef0a1f}
               ^ this image runs f()             ^ these are f() args 

buyer <--- seller
msgpack{"res", rc, stdoutfd, stderrfd}


### Option 2

test driven fabric; nodes have to be able to test to know what to cache, so...
client sends test, then everything else:

XXX test image can't be whitelisted

--->
7806991684d1a3eccacfbbd35bd3e679 68b329da9893e34099c7d8ad5cb9c940 arg1 arg2 b5532352e0c44597f3782ed66ddeb7c9  
^ this image tests output of f() ^ this image runs f()            ^ these are f() args 

<-- test return value

- test return value is a standardized format (similar to most unit test outputs)
- return value includes a fitness score
- return value includes stdout, stderr, and other file descriptors outputs from f() 
    - XXX maybe only do stdout, easier code
- nodes don't cache f() outputs unless test().rc is 0 
if rc == 0 and stdout == "" {
    // cache[word ... []string ][score int][fd int] = fd.read()
    cache[word ... []string ][score int] = container_stdout.read()
}
// nodes forward response on to whoever requested it -- can multi-hop


how containers fetch blocks:
---------------------------
078b43baa9a42850968506b6c809da46  3aafd82e7f45549c82ea3d0136f3ccae d9a46ee27b08faf0a694b4edb9065f19
^ tests to ensure hash is valid   ^ returns hash of X              ^ X is hash of the block we want

